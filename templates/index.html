<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartBank - Future of Banking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* General Body Style */
      body {
        font-family: "Inter", sans-serif;
      }

      /* Ensure views that are meant to be hidden are not displayed */
      .view.hidden,
      .modal.hidden {
        display: none !important;
      }

      /* Subtle Animations */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .animate-slide-up {
        animation: slideInUp 0.6s ease-out;
      }
      .animate-slide-right {
        animation: slideInRight 0.5s ease-out;
      }
      .animate-fade-scale {
        animation: fadeInScale 0.4s ease-out;
      }

      /* Glassmorphism & Modern Effects */
      .glass {
        background: rgba(255, 255, 255, 0.1);
        -webkit-backdrop-filter: blur(20px); /* Safari compatibility */
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .glass-dark {
        background: rgba(0, 0, 0, 0.3);
        -webkit-backdrop-filter: blur(25px); /* Safari compatibility */
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(20px); /* Safari compatibility */
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 2rem;
        border-radius: 1.5rem;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      }
      .gradient-mesh {
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 25%,
          #f093fb 50%,
          #f5576c 75%,
          #4facfe 100%
        );
        background-size: 400% 400%;
        animation: gradient-shift 8s ease infinite;
      }

      @keyframes gradient-shift {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      /* Converted @apply rules from your original stylesheet */
      .neo-btn {
        position: relative;
        overflow: hidden;
        background-image: linear-gradient(to right, #4f46e5, #7c3aed);
        color: white;
        padding: 1rem 2rem;
        border-radius: 1rem;
        font-weight: 600;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      .neo-btn:hover {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        transform: translateY(-0.25rem) scale(1.05);
      }

      .form-modern {
        width: 100%;
        padding: 1rem 1.5rem;
        background-color: rgba(249, 250, 251, 0.8);
        border: 1px solid rgba(229, 231, 235, 0.5);
        border-radius: 1rem;
        transition: all 0.3s ease-in-out;
      }

      .form-modern:hover {
        background-color: rgba(243, 244, 246, 0.8);
      }

      .form-modern:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5);
      }

      .sidebar-modern {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
        margin: 0.5rem 0.75rem;
        border-radius: 1rem;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
      }
      .sidebar-modern:hover {
        background-image: linear-gradient(
          to right,
          rgba(79, 70, 229, 0.2),
          rgba(124, 58, 237, 0.2)
        );
        transform: translateX(0.5rem);
      }
      .sidebar-modern.active {
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
      }

      .admin-sidebar-modern {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
        margin: 0.5rem 0.75rem;
        border-radius: 1rem;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
      }
      .admin-sidebar-modern:hover {
        background-image: linear-gradient(
          to right,
          rgba(239, 68, 68, 0.2),
          rgba(236, 72, 153, 0.2)
        );
        transform: translateX(0.5rem);
      }
      .admin-sidebar-modern.active {
        background: linear-gradient(135deg, #dc2626, #e11d48);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
      }

      /* Notification Styles */
      .notification {
        padding: 1rem 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        color: white;
        font-weight: 600;
        min-width: 300px;
      }
      .notification.success {
        background-color: #10b981;
      }
      .notification.error {
        background-color: #ef4444;
      }
      .notification.info {
        background-color: #3b82f6;
      }
      #notification-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      /* Chatbot styles */
      #chatbot-toggle,
      #chatbot-window {
        z-index: 90;
      }
      .chat-message {
        padding: 8px 12px;
        border-radius: 12px;
        margin-bottom: 8px;
        max-width: 80%;
      }
      .user-message {
        background-color: #4f46e5;
        color: white;
        align-self: flex-end;
        margin-left: auto;
        border-bottom-right-radius: 2px;
      }
      .bot-message {
        background-color: #e5e7eb;
        color: #1f2937;
        align-self: flex-start;
        border-bottom-left-radius: 2px;
      }
      .chat-container::-webkit-scrollbar {
        width: 8px;
      }
      .chat-container::-webkit-scrollbar-thumb {
        background-color: #d1d5db;
        border-radius: 4px;
      }
      .chat-container::-webkit-scrollbar-track {
        background-color: transparent;
      }
    </style>
  </head>
  <body class="h-full gradient-mesh">
    <div id="app" class="h-full">
      <!-- Homepage View -->
      <div id="homepage-view" class="min-h-full view hidden">
        <nav class="glass-dark fixed w-full top-0 z-50">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
              <div class="flex items-center animate-slide-right">
                <div class="relative">
                  <i class="fas fa-university text-3xl text-indigo-300"></i>
                </div>
                <span class="ml-4 text-2xl font-bold text-white"
                  >SmartBank</span
                >
                <span
                  class="ml-2 text-xs bg-gradient-to-r from-indigo-400 to-purple-400 text-white px-2 py-1 rounded-full"
                  >AI Powered</span
                >
              </div>
              <div class="flex space-x-4">
                <button data-modal="user-login-modal" class="neo-btn">
                  <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                <button
                  data-modal="user-register-modal"
                  class="glass px-6 py-3 rounded-2xl text-white font-semibold hover:bg-white/20 transition-all duration-300"
                >
                  <i class="fas fa-user-plus mr-2"></i>Register
                </button>
                <button
                  data-modal="admin-login-modal"
                  class="bg-red-600/80 backdrop-blur-sm px-6 py-3 rounded-2xl text-white font-semibold hover:bg-red-700/80 transition-all duration-300"
                >
                  <i class="fas fa-shield-alt mr-2"></i>Admin
                </button>
              </div>
            </div>
          </div>
        </nav>

        <div
          class="min-h-screen flex items-center justify-center relative overflow-hidden"
        >
          <div class="text-center text-white px-4 relative z-10">
            <h1 class="text-6xl md:text-8xl font-black mb-6 animate-slide-up">
              The Future of
              <span
                class="bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent"
                >Banking</span
              >
            </h1>
            <p
              class="text-xl md:text-3xl text-white/90 mb-12 max-w-4xl mx-auto animate-slide-up"
              style="animation-delay: 0.2s"
            >
              Experience next-generation banking with AI-powered insights,
              quantum security, and seamless digital experiences.
            </p>
            <div
              class="flex flex-col sm:flex-row gap-6 justify-center animate-slide-up"
              style="animation-delay: 0.4s"
            >
              <button
                data-modal="user-register-modal"
                class="neo-btn text-xl px-12 py-6"
              >
                <i class="fas fa-rocket mr-3"></i>Get Started Now
              </button>
              <button
                onclick="document.getElementById('features-section').scrollIntoView({ behavior: 'smooth' });"
                class="glass px-12 py-6 rounded-2xl text-white font-bold text-xl hover:bg-white/20 transition-all duration-300"
              >
                <i class="fas fa-play mr-3"></i>Discover Features
              </button>
            </div>
          </div>
        </div>
        <div id="features-section" class="py-32 relative">
          <div class="max-w-7xl mx-auto px-4">
            <h2 class="text-5xl font-black text-center text-white mb-20">
              Revolutionary Features
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
              <div class="glass-card animate-fade-scale">
                <div class="text-indigo-600 text-5xl mb-6">
                  <i class="fas fa-brain"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">AI Financial Assistant</h3>
                <p class="text-gray-600">
                  Smart chatbot powered by advanced AI to help with all your
                  banking needs, 24/7.
                </p>
              </div>
              <div
                class="glass-card animate-fade-scale"
                style="animation-delay: 0.2s"
              >
                <div class="text-green-600 text-5xl mb-6">
                  <i class="fas fa-shield-alt"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Quantum Security</h3>
                <p class="text-gray-600">
                  Military-grade encryption and biometric authentication for
                  ultimate security.
                </p>
              </div>
              <div
                class="glass-card animate-fade-scale"
                style="animation-delay: 0.4s"
              >
                <div class="text-purple-600 text-5xl mb-6">
                  <i class="fas fa-chart-line"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Smart Analytics</h3>
                <p class="text-gray-600">
                  Real-time insights and predictive analytics for better
                  financial decisions.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Dashboard View -->
      <div id="user-dashboard-view" class="view hidden min-h-full">
        <div class="min-h-screen bg-gray-100 dark:bg-gray-900 flex">
          <!-- Sidebar -->
          <div
            id="user-sidebar"
            class="flex flex-col w-64 bg-white dark:bg-gray-800 shadow-xl"
          >
            <div class="flex items-center justify-center h-20 shadow-lg">
              <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-200">
                <i class="fas fa-chart-pie text-indigo-500 mr-2"></i>Dashboard
              </h1>
            </div>
            <nav id="user-sidebar-nav" class="flex-1 px-2 py-4 space-y-2">
              <a
                href="#"
                data-view="dashboard-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300 active"
              >
                <i class="fas fa-home w-6 h-6 mr-3"></i>
                Dashboard
              </a>
              <a
                href="#"
                data-view="transactions-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-exchange-alt w-6 h-6 mr-3"></i>
                Transactions
              </a>
              <a
                href="#"
                data-view="transfer-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-paper-plane w-6 h-6 mr-3"></i>
                Transfer
              </a>
              <a
                href="#"
                data-view="bill-payment-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-file-invoice-dollar w-6 h-6 mr-3"></i>
                Bill Pay
              </a>
              <a
                href="#"
                data-view="deposit-withdraw-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-money-bill-transfer w-6 h-6 mr-3"></i>
                Deposit / Withdraw
              </a>
              <a
                href="#"
                data-view="insights-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-chart-bar w-6 h-6 mr-3"></i>
                Insights
              </a>
              <a
                href="#"
                data-view="profile-content"
                class="sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-user-circle w-6 h-6 mr-3"></i>
                Profile
              </a>
            </nav>
            <div
              class="mt-auto px-4 py-4 border-t border-gray-200 dark:border-gray-700"
            >
              <span
                class="block text-sm font-semibold text-gray-600 dark:text-gray-400"
                >Signed in as:</span
              >
              <span
                id="sidebar-username"
                class="block text-lg font-bold text-gray-800 dark:text-white"
              ></span>
              <button
                class="logout-btn w-full mt-2 py-2 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
              </button>
            </div>
          </div>

          <!-- Main Content -->
          <div id="user-main-content" class="flex-1 p-6 overflow-y-auto">
            <!-- Content will be loaded here dynamically -->
          </div>

          <!-- Chatbot Toggle Button -->
          <button
            id="chatbot-toggle"
            class="fixed bottom-6 right-6 p-4 rounded-full shadow-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors z-50"
          >
            <i class="fas fa-robot text-2xl"></i>
          </button>
        </div>
      </div>

      <!-- Admin Dashboard View -->
      <div id="admin-dashboard-view" class="view hidden min-h-full">
        <div class="min-h-screen bg-gray-100 dark:bg-gray-900 flex">
          <!-- Sidebar -->
          <div
            id="admin-sidebar"
            class="flex flex-col w-64 bg-white dark:bg-gray-800 shadow-xl"
          >
            <div
              class="flex items-center justify-center h-20 shadow-lg bg-red-600/80"
            >
              <h1 class="text-2xl font-bold text-white">
                <i class="fas fa-user-shield text-white mr-2"></i>Admin Panel
              </h1>
            </div>
            <nav id="admin-sidebar-nav" class="flex-1 px-2 py-4 space-y-2">
              <a
                href="#"
                data-view="admin-dashboard-content"
                class="admin-sidebar-modern text-gray-700 dark:text-gray-300 active"
              >
                <i class="fas fa-tachometer-alt w-6 h-6 mr-3"></i>
                Dashboard
              </a>
              <a
                href="#"
                data-view="manage-users-content"
                class="admin-sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-users-cog w-6 h-6 mr-3"></i>
                Manage Users
              </a>
              <a
                href="#"
                data-view="manage-billers-content"
                class="admin-sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-building-columns w-6 h-6 mr-3"></i>
                Manage Billers
              </a>
              <a
                href="#"
                data-view="manage-transactions-content"
                class="admin-sidebar-modern text-gray-700 dark:text-gray-300"
              >
                <i class="fas fa-list-ul w-6 h-6 mr-3"></i>
                All Transactions
              </a>
            </nav>
            <div
              class="mt-auto px-4 py-4 border-t border-gray-200 dark:border-gray-700"
            >
              <span
                class="block text-sm font-semibold text-gray-600 dark:text-gray-400"
                >Signed in as:</span
              >
              <span
                id="admin-sidebar-username"
                class="block text-lg font-bold text-gray-800 dark:text-white"
                >Admin</span
              >
              <button
                class="logout-btn w-full mt-2 py-2 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
              </button>
            </div>
          </div>
          <!-- Main Content -->
          <div id="admin-main-content" class="flex-1 p-6 overflow-y-auto">
            <!-- Content will be loaded here dynamically -->
          </div>
        </div>
      </div>
      <!-- Modals and Notifications -->
      <div id="notification-container"></div>
      <!-- User Login Modal -->
      <div
        id="user-login-modal"
        class="modal fixed inset-0 z-50 hidden flex items-center justify-center glass-dark animate-fade-scale"
      >
        <div class="glass-card w-full max-w-lg p-8">
          <h2 class="text-3xl font-bold text-center mb-6">User Login</h2>
          <form id="user-login-form">
            <div class="mb-4">
              <input
                type="text"
                id="user-username"
                name="user-username"
                placeholder="Username"
                required
                class="form-modern"
              />
            </div>
            <div class="mb-6">
              <input
                type="password"
                id="user-password"
                name="user-password"
                placeholder="Password"
                required
                class="form-modern"
              />
            </div>
            <button type="submit" class="neo-btn w-full">Log In</button>
          </form>
          <div class="flex justify-center mt-4">
            <a
              href="#"
              data-modal="user-register-modal"
              class="text-sm text-gray-600 hover:text-indigo-600 transition-colors"
              >Don't have an account? Register</a
            >
          </div>
          <button
            class="close-modal absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl"
          >
            &times;
          </button>
        </div>
      </div>
      <!-- Admin Login Modal -->
      <div
        id="admin-login-modal"
        class="modal fixed inset-0 z-50 hidden flex items-center justify-center glass-dark animate-fade-scale"
      >
        <div class="glass-card w-full max-w-lg p-8">
          <h2 class="text-3xl font-bold text-center mb-6">Admin Login</h2>
          <form id="admin-login-form">
            <div class="mb-4">
              <input
                type="text"
                id="admin-username"
                name="admin-username"
                placeholder="Username"
                required
                class="form-modern"
              />
            </div>
            <div class="mb-6">
              <input
                type="password"
                id="admin-password"
                name="admin-password"
                placeholder="Password"
                required
                class="form-modern"
              />
            </div>
            <button type="submit" class="neo-btn w-full">
              Log In as Admin
            </button>
          </form>
          <button
            class="close-modal absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl"
          >
            &times;
          </button>
        </div>
      </div>
      <!-- User Registration Modal -->
      <div
        id="user-register-modal"
        class="modal fixed inset-0 z-50 hidden flex items-center justify-center glass-dark animate-fade-scale"
      >
        <div class="glass-card w-full max-w-lg p-8">
          <h2 class="text-3xl font-bold text-center mb-6">Register</h2>
          <form id="register-form">
            <div class="mb-4">
              <input
                type="text"
                id="register-username"
                name="register-username"
                placeholder="Username"
                required
                class="form-modern"
              />
            </div>
            <div class="mb-4">
              <input
                type="email"
                id="register-email"
                name="register-email"
                placeholder="Email"
                required
                class="form-modern"
              />
            </div>
            <div class="mb-6">
              <input
                type="password"
                id="register-password"
                name="register-password"
                placeholder="Password"
                required
                class="form-modern"
              />
            </div>
            <button type="submit" class="neo-btn w-full">Register</button>
          </form>
          <div class="flex justify-center mt-4">
            <a
              href="#"
              data-modal="user-login-modal"
              class="text-sm text-gray-600 hover:text-indigo-600 transition-colors"
              >Already have an account? Login</a
            >
          </div>
          <button
            class="close-modal absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl"
          >
            &times;
          </button>
        </div>
      </div>
      <!-- 2FA Modal -->
      <div
        id="tfa-modal"
        class="modal fixed inset-0 z-50 hidden flex items-center justify-center glass-dark animate-fade-scale"
      >
        <div class="glass-card w-full max-w-lg p-8">
          <h2 class="text-3xl font-bold text-center mb-6">Verify 2FA</h2>
          <p class="text-center text-gray-600 mb-4">
            A 6-digit code has been sent to your email.
          </p>
          <div class="mb-6">
            <input
              type="text"
              id="tfa-code"
              placeholder="Enter 2FA Code"
              required
              class="form-modern"
            />
          </div>
          <button id="verify-2fa-btn" class="neo-btn w-full">Verify</button>
          <button
            class="close-modal absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl"
          >
            &times;
          </button>
        </div>
      </div>
      <!-- Confirm Delete Modal -->
      <div
        id="confirm-delete-modal"
        class="modal fixed inset-0 z-50 hidden flex items-center justify-center glass-dark animate-fade-scale"
      >
        <div class="glass-card w-full max-w-sm p-8 text-center">
          <h2 class="text-2xl font-bold mb-4">Confirm Deletion</h2>
          <p class="text-gray-600 mb-6">
            Are you sure you want to delete this user? This action cannot be
            undone.
          </p>
          <div class="flex justify-center gap-4">
            <button
              id="confirm-delete-btn"
              class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors"
            >
              Delete
            </button>
            <button
              id="cancel-delete-btn"
              class="bg-gray-300 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-400 transition-colors close-modal"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
      <!-- Main Chatbot Container -->
      <div
        id="chatbot-window"
        class="fixed bottom-24 right-6 w-full max-w-sm h-[60vh] bg-white rounded-xl shadow-2xl flex flex-col hidden z-50 overflow-hidden"
      >
        <!-- Header -->
        <header
          class="bg-blue-600 text-white p-4 rounded-t-xl flex items-center justify-between"
        >
          <div class="flex items-center space-x-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-8 h-8 text-white"
            >
              <path
                fill-rule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6a.75.75 0 0 0 .75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z"
                clip-rule="evenodd"
              />
            </svg>
            <h1 class="text-2xl font-bold">Gemini Chat</h1>
          </div>
          <button id="chatbot-close" class="text-white hover:text-gray-200">
            <i class="fas fa-times"></i>
          </button>
        </header>

        <!-- Chat Log Display -->
        <div
          id="chat-container"
          class="flex-grow p-6 overflow-y-auto chat-container flex flex-col space-y-4 bg-gray-50"
        >
          <!-- Initial Bot Message -->
          <div class="flex items-start space-x-3 pr-8">
            <div
              class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="w-5 h-5"
              >
                <path
                  d="M11.25 4.507A4.5 4.5 0 0 0 9 2.25H7.5a.75.75 0 0 0-.75.75v2.25a.75.75 0 0 0 .75.75h.75c.954 0 1.837.568 2.25 1.442v10.316a.75.75 0 0 0-.75.75 2.25 2.25 0 0 1-4.5 0 .75.75 0 0 0-.75-.75H3a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h1.5A4.5 4.5 0 0 0 9 19.5a.75.75 0 0 0 .75.75h.75a.75.75 0 0 0 .75-.75v-2.25a.75.75 0 0 0-.75-.75h-.75A2.25 2.25 0 0 1 6 15a.75.75 0 0 0-.75-.75H3a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h1.5a4.5 4.5 0 0 0 4.5 4.5h2.25a.75.75 0 0 0 .75-.75V2.25a.75.75 0 0 0-.75-.75h-2.25a.75.75 0 0 0-.75.75V4.5A.75.75 0 0 1 9.75 5.25H11.25V4.507ZM21.75 3a.75.75 0 0 0-.75.75v16.5a.75.75 0 0 0 1.5 0V3.75a.75.75 0 0 0-.75-.75Z"
                />
              </svg>
            </div>
            <div
              class="bg-gray-200 text-gray-800 p-4 rounded-2xl rounded-tl-none max-w-[85%]"
            >
              <p>
                Hello! I am a simple chatbot powered by Gemini. How can I help
                you today?
              </p>
            </div>
          </div>
        </div>

        <!-- Typing Indicator -->
        <div
          id="typing-indicator"
          class="flex items-start space-x-3 p-4 hidden"
        >
          <div
            class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-5 h-5"
            >
              <path
                d="M11.25 4.507A4.5 4.5 0 0 0 9 2.25H7.5a.75.75 0 0 0-.75.75v2.25a.75.75 0 0 0 .75.75h.75c.954 0 1.837.568 2.25 1.442v10.316a.75.75 0 0 0-.75.75 2.25 2.25 0 0 1-4.5 0 .75.75 0 0 0-.75-.75H3a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h1.5A4.5 4.5 0 0 0 9 19.5a.75.75 0 0 0 .75.75h.75a.75.75 0 0 0 .75-.75v-2.25a.75.75 0 0 0-.75-.75h-.75A2.25 2.25 0 0 1 6 15a.75.75 0 0 0-.75-.75H3a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h1.5a4.5 4.5 0 0 0 4.5 4.5h2.25a.75.75 0 0 0 .75-.75V2.25a.75.75 0 0 0-.75-.75h-2.25a.75.75 0 0 0-.75.75V4.5A.75.75 0 0 1 9.75 5.25H11.25V4.507ZM21.75 3a.75.75 0 0 0-.75.75v16.5a.75.75 0 0 0 1.5 0V3.75a.75.75 0 0 0-.75-.75Z"
              />
            </svg>
          </div>
          <div class="p-3 bg-gray-200 rounded-2xl rounded-tl-none">
            <div class="flex space-x-1">
              <span
                class="h-2 w-2 bg-gray-400 rounded-full animate-bounce"
                style="animation-delay: -0.32s"
              ></span>
              <span
                class="h-2 w-2 bg-gray-400 rounded-full animate-bounce"
                style="animation-delay: -0.16s"
              ></span>
              <span
                class="h-2 w-2 bg-gray-400 rounded-full animate-bounce"
              ></span>
            </div>
          </div>
        </div>

        <!-- Input and Send Message Form -->
        <form
          id="chat-form"
          class="p-4 border-t border-gray-200 bg-white flex items-center space-x-4"
        >
          <input
            type="text"
            id="user-input"
            placeholder="Type a message..."
            required
            class="flex-grow p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
          />
          <button
            type="submit"
            id="send-btn"
            class="bg-blue-600 text-white rounded-full p-3 shadow-md hover:bg-blue-700 transition-all duration-200 transform hover:scale-105"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"
              />
            </svg>
          </button>
        </form>
      </div>
    </div>
    <script>
      /**
       * Makes a specific modal visible on the screen.
       * @param {string} modalId The ID of the modal element to show.
       */
      function showModal(modalId) {
        document.getElementById(modalId)?.classList.remove("hidden");
      }

      /**
       * Hides all visible modals.
       */
      function closeModals() {
        document.querySelectorAll(".modal").forEach((modal) => {
          modal.classList.add("hidden");
        });
      }

      /**
       * Displays a temporary notification message on the screen.
       * @param {string} message The message to display.
       * @param {'info' | 'success' | 'error'} type The type of notification, which affects its color.
       * @param {number} duration The time in milliseconds before the notification disappears.
       */
      function showNotification(message, type = "info", duration = 4000) {
        const container = document.getElementById("notification-container");
        if (!container) return;

        const notification = document.createElement("div");
        notification.className = `notification ${type} animate-slide-right`;

        const iconClass =
          type === "success"
            ? "fa-check-circle"
            : type === "error"
            ? "fa-exclamation-triangle"
            : "fa-info-circle";

        notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${iconClass} mr-3"></i>
                    <span>${message}</span>
                    <button class="ml-auto text-white/70 hover:text-white close-notification">&times;</button>
                </div>
            `;

        const closeButton = notification.querySelector(".close-notification");
        closeButton.onclick = () => notification.remove();

        container.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, duration);
      }

      /**
       * Manages which main view is visible on the single-page application.
       * Hides all other views and shows the one with the specified ID.
       * @param {string} viewId The ID of the view element to display (e.g., 'homepage-view').
       */
      function showView(viewId) {
        document.querySelectorAll(".view").forEach((view) => {
          view.classList.add("hidden");
        });
        const viewToShow = document.getElementById(viewId);
        if (viewToShow) {
          viewToShow.classList.remove("hidden");
        } else {
          console.error(`View with id "${viewId}" not found.`);
          // Fallback to homepage if view is not found to prevent a blank screen.
          document.getElementById("homepage-view")?.classList.remove("hidden");
        }
      }

      /**
       * Loads content from an HTML <template> tag into a specified container.
       */
      function loadViewContent(viewId, mainContentId) {
        const templateId = `${viewId}-template`;
        const template = document.getElementById(templateId);
        const container = document.getElementById(mainContentId);

        if (template && container) {
          container.innerHTML = template.innerHTML;

          const event = new CustomEvent("contentLoaded", {
            detail: { viewId, container },
          });
          document.dispatchEvent(event);
        } else {
          console.error(
            `Template or container not found for view: ${templateId}`
          );
          container.innerHTML = `<p class="text-red-500">Error: Could not load content for this view.</p>`;
        }
      }

      /**
       * A centralized function for making API requests.
       * It automatically includes the auth token and handles basic error scenarios.
       * @param {string} endpoint The API endpoint to call (e.g., '/login').
       * @param {string} method The HTTP method (e.g., 'GET', 'POST').
       * @param {object|null} body The request body for POST/PUT requests.
       * @returns {Promise<{ok: boolean, data: any}>} An object with the request status and data.
       */
      async function apiRequest(endpoint, method = "GET", body = null) {
        const headers = {};
        const token = localStorage.getItem("token");
        if (token) {
          headers["x-access-token"] = token;
        }
        if (body && !(body instanceof FormData)) {
          headers["Content-Type"] = "application/json";
        }

        try {
          const response = await fetch(`/api${endpoint}`, {
            method,
            headers,
            body: body ? JSON.stringify(body) : null,
          });

          const contentType = response.headers.get("Content-Type");

          if (response.status === 401) {
            logout(); // Token expired or invalid
            return {
              ok: false,
              data: { message: "Session expired. Please log in again." },
            };
          }

          if (!response.ok) {
            const errorData = contentType?.includes("application/json")
              ? await response.json()
              : {
                  message: `Server error: ${response.status} ${response.statusText}`,
                };
            return { ok: false, data: errorData };
          }

          if (contentType && contentType.includes("application/pdf")) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            const filename =
              response.headers
                .get("Content-Disposition")
                ?.split("filename=")[1] ||
              `transactions_report_${
                new Date().toISOString().split("T")[0]
              }.pdf`;
            a.download = filename.replace(/"/g, "");
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            return {
              ok: true,
              data: { message: "Report downloaded successfully." },
            };
          }

          const data = await response.json();
          return { ok: response.ok, data };
        } catch (error) {
          console.error("API Request Error:", { endpoint, error });
          return { ok: false, data: { message: "Network or server error." } };
        }
      }

      let pendingUserId = null; // Stores user ID during 2FA process

      async function handleUserLogin(e) {
        e.preventDefault();
        const username = e.target.elements["user-username"].value;
        const password = e.target.elements["user-password"].value;

        const res = await apiRequest("/login", "POST", {
          username,
          password,
        });
        if (res.ok) {
          pendingUserId = res.data.user_id;
          closeModals();
          showModal("tfa-modal");
        } else {
          showNotification(res.data.message, "error");
        }
      }

      async function handleAdminLogin(e) {
        e.preventDefault();
        const username = e.target.elements["admin-username"].value;
        const password = e.target.elements["admin-password"].value;

        const res = await apiRequest("/admin/login", "POST", {
          username,
          password,
        });
        if (res.ok) {
          localStorage.setItem("token", res.data.token);
          localStorage.setItem("username", res.data.username);
          localStorage.setItem("isAdmin", "true");
          closeModals();
          showNotification(`Welcome, ${res.data.username}!`, "success");
          initAdminDashboard();
        } else {
          showNotification(res.data.message, "error");
        }
      }

      async function handleRegistration(e) {
        e.preventDefault();
        const username = e.target.elements["register-username"].value;
        const email = e.target.elements["register-email"].value;
        const password = e.target.elements["register-password"].value;

        const res = await apiRequest("/register", "POST", {
          username,
          email,
          password,
        });
        if (res.ok) {
          // CHANGED: The user is now notified that their account is pending approval
          showNotification(
            "Registration successful! Your account is pending admin approval.",
            "info"
          );
          closeModals();
        } else {
          showNotification(res.data.message, "error");
        }
      }

      async function verify2FA() {
        const code = document.getElementById("tfa-code").value;
        if (!code || !pendingUserId) {
          showNotification("Verification code is required.", "error");
          return;
        }

        const res = await apiRequest("/login/verify", "POST", {
          user_id: pendingUserId,
          code,
        });

        if (res.ok) {
          localStorage.setItem("token", res.data.token);
          localStorage.setItem("username", res.data.username);
          localStorage.setItem("isAdmin", "false");
          pendingUserId = null; // Clear after use
          closeModals();
          showNotification(`Welcome back, ${res.data.username}!`, "success");
          initUserDashboard();
        } else {
          showNotification(res.data.message, "error");
        }
      }

      function logout() {
        localStorage.clear();
        // Use window.location to ensure a full page reload and state reset
        window.location.href = "/";
      }

      function initUserDashboard() {
        showView("user-dashboard-view");
        document.getElementById("chatbot-window").classList.remove("hidden");
        const username = localStorage.getItem("username") || "User";
        const sidebarUsername = document.getElementById("sidebar-username");
        if (sidebarUsername) sidebarUsername.textContent = username;

        setupNavigation("user-sidebar-nav", "user-main-content", false);
        loadViewContent("dashboard-content", "user-main-content");
      }

      function initAdminDashboard() {
        showView("admin-dashboard-view");
        document.getElementById("chatbot-window").classList.add("hidden");
        const username = localStorage.getItem("username") || "Admin";
        const sidebarUsername = document.getElementById(
          "admin-sidebar-username"
        );
        if (sidebarUsername) sidebarUsername.textContent = username;

        setupNavigation("admin-sidebar-nav", "admin-main-content", true);
        loadViewContent("admin-dashboard-content", "admin-main-content");
      }

      function setupNavigation(containerId, mainContentId, isAdminNav) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.addEventListener("click", (e) => {
          const link = e.target.closest("a");
          if (link && link.dataset.view) {
            e.preventDefault();
            container
              .querySelectorAll("a")
              .forEach((i) => i.classList.remove("active"));
            link.classList.add("active");
            loadViewContent(link.dataset.view, mainContentId);
          }
        });
      }

      // Gemini Chatbot logic starts here
      const API_KEY = "AIzaSyA2eVYch6UY0vmSfEYojB5V7E21bRB3HxM";

      // Constants and DOM elements
      const chatbotToggle = document.getElementById("chatbot-toggle");
      const chatbotWindow = document.getElementById("chatbot-window");
      const chatbotClose = document.getElementById("chatbot-close");
      const chatForm = document.getElementById("chat-form");
      const userInput = document.getElementById("user-input");
      const chatContainer = document.getElementById("chat-container");
      const typingIndicator = document.getElementById("typing-indicator");
      const sendBtn = document.getElementById("send-btn");
      const model = "gemini-2.5-flash-preview-05-20";

      // Stores the conversation history for multi-turn chat
      let chatHistory = [];

      // --- Event Listeners and Modal Logic ---
      function initChatbot() {
        chatbotToggle.addEventListener("click", () =>
          chatbotWindow.classList.toggle("hidden")
        );
        chatbotClose.addEventListener("click", () =>
          chatbotWindow.classList.add("hidden")
        );
        chatForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const message = userInput.value.trim();
          if (message) {
            addMessageToChat(message, "user");
            userInput.value = "";
            showTypingIndicator();
            try {
              await getGeminiResponse(message);
            } catch (error) {
              console.error("API Error:", error);
              hideTypingIndicator();
              showModal(
                "There was an error communicating with the API. Please check your key and try again."
              );
            }
          }
        });
      }

      // --- UI Functions ---
      function addMessageToChat(message, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("flex", "items-start", "space-x-3");

        const avatarDiv = document.createElement("div");
        avatarDiv.classList.add(
          "flex-shrink-0",
          "w-8",
          "h-8",
          "rounded-full",
          "flex",
          "items-center",
          "justify-center"
        );

        const messageContentDiv = document.createElement("div");
        messageContentDiv.classList.add(
          "p-4",
          "rounded-2xl",
          "max-w-[85%]",
          "break-words"
        );

        if (sender === "user") {
          messageDiv.classList.add("self-end", "justify-end");
          messageDiv.classList.add("pl-8");
          avatarDiv.classList.add("hidden"); // Hide user avatar
          messageContentDiv.classList.add(
            "bg-blue-600",
            "text-white",
            "rounded-br-none"
          );
        } else {
          messageDiv.classList.add("pr-8");
          avatarDiv.classList.add("bg-blue-500", "text-white");
          avatarDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                    <path d="M11.25 4.507A4.5 4.5 0 0 0 9 2.25H7.5a.75.75 0 0 0-.75.75v2.25a.75.75 0 0 0 .75.75h.75c.954 0 1.837.568 2.25 1.442v10.316a.75.75 0 0 0-.75.75 2.25 2.25 0 0 1-4.5 0 .75.75 0 0 0-.75-.75H3a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h1.5A4.5 4.5 0 0 0 9 19.5a.75.75 0 0 0 .75.75h.75a.75.75 0 0 0 .75-.75v-2.25a.75.75 0 0 0-.75-.75h-.75A2.25 2.25 0 0 1 6 15a.75.75 0 0 0-.75-.75H3a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h1.5a4.5 4.5 0 0 0 4.5 4.5h2.25a.75.75 0 0 0 .75-.75V2.25a.75.75 0 0 0-.75-.75h-2.25a.75.75 0 0 0-.75.75V4.5A.75.75 0 0 1 9.75 5.25H11.25V4.507ZM21.75 3a.75.75 0 0 0-.75.75v16.5a.75.75 0 0 0 1.5 0V3.75a.75.75 0 0 0-.75-.75Z" />
                                </svg>`;
          messageContentDiv.classList.add(
            "bg-gray-200",
            "text-gray-800",
            "rounded-tl-none"
          );
        }

        const p = document.createElement("p");
        p.textContent = message;
        messageContentDiv.appendChild(p);

        if (sender === "user") {
          messageDiv.appendChild(messageContentDiv);
        } else {
          messageDiv.appendChild(avatarDiv);
          messageDiv.appendChild(messageContentDiv);
        }

        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function showTypingIndicator() {
        typingIndicator.classList.remove("hidden");
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function hideTypingIndicator() {
        typingIndicator.classList.add("hidden");
      }

      // --- Gemini API Call ---
      async function getGeminiResponse(userMessage) {
        if (!API_KEY) {
          hideTypingIndicator();
          showModal(
            "API key is not configured. Please get a key from Google AI Studio and paste it into the code."
          );
          return;
        }

        // Append the user's message to the chat history
        chatHistory.push({ role: "user", parts: [{ text: userMessage }] });

        const payload = {
          contents: chatHistory,
        };

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`;

        try {
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.error.message ||
                `HTTP error! status: ${response.status}`
            );
          }

          const result = await response.json();
          const text = result.candidates[0].content.parts[0].text;

          // Append the model's response to the chat history
          chatHistory.push({ role: "model", parts: [{ text: text }] });

          hideTypingIndicator();
          addMessageToChat(text, "model");
        } catch (error) {
          console.error("Failed to fetch from Gemini API:", error);
          hideTypingIndicator();
          showModal(
            "There was an error generating a response from the AI. Please try again."
          );
        }
      }
      // End Gemini Chatbot logic

      const userDashboardContentTemplate = `
            <template id="dashboard-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">My Dashboard</h2>
                    <div id="account-summary" class="bg-indigo-600 text-white p-6 rounded-xl shadow-lg mb-8">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-semibold">Current Balance</span>
                            <span id="account-type" class="text-xs bg-indigo-800 px-3 py-1 rounded-full">Checking</span>
                        </div>
                        <div class="text-4xl font-bold mb-1">
                            <span id="account-balance">0.00</span>
                        </div>
                        <div class="text-sm">Account: <span id="account-number"></span></div>
                    </div>
                    <h3 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Recent Transactions</h3>
                    <div id="recent-transactions-list" class="space-y-4">
                        <p class="text-gray-500">Loading transactions...</p>
                    </div>
                </div>
            </template>
            <template id="transactions-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Transaction History</h2>
                    <div id="user-transactions-list" class="space-y-4">
                        <p class="text-gray-500">Loading transactions...</p>
                    </div>
                </div>
            </template>
            <template id="transfer-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Money Transfer</h2>
                    <form id="transfer-form">
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">Recipient Account Number</label>
                            <input type="text" id="transfer-to-account" required class="form-modern">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">Amount</label>
                            <input type="number" id="transfer-amount" required min="0.01" step="0.01" class="form-modern">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">Description (Optional)</label>
                            <input type="text" id="transfer-description" class="form-modern">
                        </div>
                        <button type="submit" class="neo-btn w-full">Transfer Money</button>
                    </form>
                </div>
            </template>
            <template id="bill-payment-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Bill Payment</h2>
                    <form id="bill-payment-form">
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">Select Biller</label>
                            <select id="biller-select" class="form-modern" required>
                                <option value="">Loading billers...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">Amount</label>
                            <input type="number" id="bill-amount" required min="0.01" step="0.01" class="form-modern">
                        </div>
                        <button type="submit" class="neo-btn w-full">Pay Bill</button>
                    </form>
                </div>
            </template>
            <template id="insights-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Spending Insights</h2>
                    <canvas id="spending-chart" class="w-full"></canvas>
                </div>
            </template>
            <template id="profile-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">My Profile</h2>
                    <p class="text-gray-600 dark:text-gray-400">Profile details will be displayed here.</p>
                </div>
            </template>
            <template id="deposit-withdraw-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Deposit / Withdraw</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Deposit Form -->
                        <div class="bg-gray-50 dark:bg-gray-900 p-6 rounded-lg shadow">
                            <h3 class="text-2xl font-bold mb-4">Deposit Funds</h3>
                            <form id="deposit-form">
                                <div class="mb-4">
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2">Amount ()</label>
                                    <input type="number" id="deposit-amount" required min="1" step="0.01" class="form-modern">
                                </div>
                                <button type="submit" class="neo-btn w-full">Deposit</button>
                            </form>
                        </div>
                        <!-- Withdraw Form -->
                        <div class="bg-gray-50 dark:bg-gray-900 p-6 rounded-lg shadow">
                            <h3 class="text-2xl font-bold mb-4">Withdraw Funds</h3>
                            <form id="withdraw-form">
                                <div class="mb-4">
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2">Amount ()</label>
                                    <input type="number" id="withdraw-amount" required min="1" step="0.01" class="form-modern">
                                </div>
                                <button type="submit" class="neo-btn w-full bg-red-600 hover:bg-red-700">Withdraw</button>
                            </form>
                        </div>
                    </div>
                </div>
            </template>
        `;

      const adminDashboardContentTemplate = `
            <template id="admin-dashboard-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Admin Dashboard</h2>
                    <div id="admin-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="glass-card text-center p-4">
                            <h3 class="text-xl font-semibold">Total Users</h3>
                            <p id="total-users" class="text-3xl font-bold text-indigo-600">0</p>
                        </div>
                        <div class="glass-card text-center p-4">
                            <h3 class="text-xl font-semibold">Total Accounts</h3>
                            <p id="total-accounts" class="text-3xl font-bold text-green-600">0</p>
                        </div>
                        <div class="glass-card text-center p-4">
                            <h3 class="text-xl font-semibold">Today's Transactions</h3>
                            <p id="transactions-today" class="text-3xl font-bold text-orange-600">0</p>
                        </div>
                        <div class="glass-card text-center p-4">
                            <h3 class="text-xl font-semibold">Security Alerts</h3>
                            <p id="security-alerts" class="text-3xl font-bold text-red-600">0</p>
                        </div>
                    </div>
                </div>
            </template>
            <template id="manage-users-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Manage Users</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- User data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </template>
            <template id="manage-billers-content-template">
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Manage Billers</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Biller Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                </tr>
                            </thead>
                            <tbody id="billers-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Biller data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </template>
            <template id="manage-transactions-content-template">
                <div class="p-6 bg-gray-900 text-white rounded-xl shadow-xl">
                    <h2 class="text-3xl font-bold mb-6">All Transactions</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Transaction ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">From Account</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">To Account</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Description</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Timestamp</th>
                                </tr>
                            </thead>
                            <tbody id="all-transactions-table-body" class="bg-gray-800 divide-y divide-gray-700">
                                <!-- Transaction data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </template>
        `;

      document.body.insertAdjacentHTML(
        "beforeend",
        userDashboardContentTemplate
      );
      document.body.insertAdjacentHTML(
        "beforeend",
        adminDashboardContentTemplate
      );

      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        const isAdmin = localStorage.getItem("isAdmin") === "true";

        if (token) {
          if (isAdmin) {
            initAdminDashboard();
          } else {
            initUserDashboard();
          }
        } else {
          showView("homepage-view");
        }

        document
          .getElementById("user-login-form")
          ?.addEventListener("submit", handleUserLogin);
        document
          .getElementById("admin-login-form")
          ?.addEventListener("submit", handleAdminLogin);
        document
          .getElementById("register-form")
          ?.addEventListener("submit", handleRegistration);

        document.querySelectorAll("[data-modal]").forEach((button) => {
          button.addEventListener("click", () => {
            showModal(button.dataset.modal);
          });
        });

        document.querySelectorAll(".close-modal").forEach((button) => {
          button.addEventListener("click", closeModals);
        });

        document
          .getElementById("verify-2fa-btn")
          ?.addEventListener("click", verify2FA);

        document.querySelectorAll(".logout-btn").forEach((button) => {
          button.addEventListener("click", logout);
        });

        initChatbot();
      });

      document.addEventListener("contentLoaded", async (e) => {
        if (e.detail.viewId === "manage-users-content") {
          await loadManageUsers();
        } else if (e.detail.viewId === "dashboard-content") {
          await loadUserDashboard();
        } else if (e.detail.viewId === "deposit-withdraw-content") {
          setupDepositWithdrawForms();
        } else if (e.detail.viewId === "admin-dashboard-content") {
          await loadAdminDashboardStats();
        } else if (e.detail.viewId === "manage-transactions-content") {
          await loadAllTransactions();
        } else if (e.detail.viewId === "manage-billers-content") {
          await loadManageBillers();
        }
      });

      async function loadUserDashboard() {
        const accountRes = await apiRequest("/account", "GET");
        if (accountRes.ok) {
          document.getElementById("account-balance").textContent = parseFloat(
            accountRes.data.account.balance
          ).toFixed(2);
          document.getElementById("account-number").textContent =
            accountRes.data.account.account_number;
        } else {
          showNotification(
            "Failed to load account details. Please try again.",
            "error"
          );
          document.getElementById("account-balance").textContent = "Error";
          document.getElementById("account-number").textContent = "Error";
        }

        const transactionsRes = await apiRequest("/transactions", "GET");
        if (transactionsRes.ok) {
          const list = document.getElementById("recent-transactions-list");
          list.innerHTML = "";
          if (transactionsRes.data.transactions.length > 0) {
            transactionsRes.data.transactions.slice(0, 5).forEach((tx) => {
              const transactionItem = document.createElement("div");
              transactionItem.className =
                "flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg";
              transactionItem.innerHTML = `
                        <div>
                            <div class="font-semibold text-gray-800 dark:text-white">${
                              tx.description
                            }</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">${new Date(
                              tx.timestamp
                            ).toLocaleString()}</div>
                        </div>
                        <div class="font-bold text-lg">${tx.amount}</div>
                    `;
              list.appendChild(transactionItem);
            });
          } else {
            list.innerHTML =
              '<p class="text-gray-500">No recent transactions found.</p>';
          }
        } else {
          showNotification(
            "Failed to load transactions. Please try again.",
            "error"
          );
          document.getElementById("recent-transactions-list").innerHTML =
            '<p class="text-red-500">Failed to load transactions.</p>';
        }
      }

      function setupDepositWithdrawForms() {
        document
          .getElementById("deposit-form")
          ?.addEventListener("submit", async (e) => {
            e.preventDefault();
            const amount = document.getElementById("deposit-amount").value;
            const res = await apiRequest("/deposit", "POST", {
              amount: parseFloat(amount),
            });
            showNotification(res.data.message, res.ok ? "success" : "error");
            if (res.ok) {
              document.getElementById("deposit-form").reset();
              loadViewContent("dashboard-content", "user-main-content");
            }
          });

        document
          .getElementById("withdraw-form")
          ?.addEventListener("submit", async (e) => {
            e.preventDefault();
            const amount = document.getElementById("withdraw-amount").value;
            const res = await apiRequest("/withdraw", "POST", {
              amount: parseFloat(amount),
            });
            showNotification(res.data.message, res.ok ? "success" : "error");
            if (res.ok) {
              document.getElementById("withdraw-form").reset();
              loadViewContent("dashboard-content", "user-main-content");
            }
          });
      }

      async function loadManageUsers() {
        const usersTableBody = document.getElementById("users-table-body");
        usersTableBody.innerHTML =
          '<tr><td colspan="4" class="text-center py-4">Loading users...</td></tr>';

        const res = await apiRequest("/admin/users", "GET");

        if (res.ok) {
          usersTableBody.innerHTML = "";
          res.data.users.forEach((user) => {
            const row = document.createElement("tr");
            row.className = "hover:bg-gray-50 dark:hover:bg-gray-700";

            // CHANGED: Added logic for 'pending' status
            let statusColor = "";
            let actionBtnText = "";
            let actionBtnColor = "";
            let newStatus = "";

            if (user.status === "active") {
              statusColor = "text-green-500";
              actionBtnText = "Suspend";
              actionBtnColor = "bg-orange-500";
              newStatus = "suspended";
            } else if (user.status === "suspended") {
              statusColor = "text-red-500";
              actionBtnText = "Activate";
              actionBtnColor = "bg-green-500";
              newStatus = "active";
            } else if (user.status === "pending") {
              statusColor = "text-yellow-500";
              actionBtnText = "Approve";
              actionBtnColor = "bg-indigo-600";
              newStatus = "active"; // Approve changes status to active
            }

            row.innerHTML = `
                      <td class="px-6 py-4 whitespace-nowrap">${user.username}</td>
                      <td class="px-6 py-4 whitespace-nowrap">${user.email}</td>
                      <td class="px-6 py-4 whitespace-nowrap">
                          <span class="font-semibold ${statusColor}">${user.status}</span>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <button data-user-id="${user._id}" data-action="toggle-status" data-current-status="${user.status}" data-new-status="${newStatus}" class="text-white ${actionBtnColor} px-3 py-1 rounded-full text-xs hover:opacity-80 transition-opacity mr-2">
                              ${actionBtnText}
                          </button>
                          <button data-user-id="${user._id}" data-action="delete" class="text-white bg-red-600 px-3 py-1 rounded-full text-xs hover:bg-red-700 transition-colors">
                              Delete
                          </button>
                      </td>
                  `;
            usersTableBody.appendChild(row);
          });

          usersTableBody.addEventListener("click", async (e) => {
            const button = e.target.closest("button");
            if (!button) return;

            const userId = button.dataset.userId;
            const action = button.dataset.action;

            if (action === "toggle-status") {
              const newStatus = button.dataset.newStatus;
              const res = await apiRequest(`/admin/users/${userId}`, "PUT", {
                status: newStatus,
              });
              if (res.ok) {
                showNotification(res.data.message, "success");
                await loadManageUsers();
              } else {
                showNotification(res.data.message, "error");
              }
            } else if (action === "delete") {
              showModal("confirm-delete-modal");
              document.getElementById("confirm-delete-btn").onclick =
                async () => {
                  closeModals();
                  const res = await apiRequest(
                    `/admin/users/${userId}`,
                    "DELETE"
                  );
                  if (res.ok) {
                    showNotification(res.data.message, "success");
                    await loadManageUsers();
                  } else {
                    showNotification(res.data.message, "error");
                  }
                };
            }
          });
        } else {
          usersTableBody.innerHTML = `<tr><td colspan="4" class="text-center text-red-500 py-4">${res.data.message}</td></tr>`;
        }
      }

      async function loadManageBillers() {
        const billersTableBody = document.getElementById("billers-table-body");
        billersTableBody.innerHTML =
          '<tr><td colspan="2" class="text-center py-4">Loading billers...</td></tr>';

        const res = await apiRequest("/billers", "GET");
        if (res.ok) {
          billersTableBody.innerHTML = "";
          if (res.data.billers.length > 0) {
            res.data.billers.forEach((biller) => {
              const row = document.createElement("tr");
              row.className = "hover:bg-gray-50 dark:hover:bg-gray-700";
              row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">${biller.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${biller.category}</td>
                    `;
              billersTableBody.appendChild(row);
            });
          } else {
            billersTableBody.innerHTML = `<tr><td colspan="2" class="text-center text-gray-500 py-4">No billers found.</td></tr>`;
          }
        } else {
          billersTableBody.innerHTML = `<tr><td colspan="2" class="text-center text-red-500 py-4">${res.data.message}</td></tr>`;
        }
      }

      async function loadAdminDashboardStats() {
        // No stats to load anymore since reports have been removed.
        const totalUsers = "N/A";
        const totalAccounts = "N/A";
        const transactionsToday = "N/A";
        const securityAlerts = "N/A";

        document.getElementById("total-users").textContent = totalUsers;
        document.getElementById("total-accounts").textContent = totalAccounts;
        document.getElementById("transactions-today").textContent =
          transactionsToday;
        document.getElementById("security-alerts").textContent = securityAlerts;
      }

      async function loadAllTransactions() {
        const transactionsTableBody = document.getElementById(
          "all-transactions-table-body"
        );
        transactionsTableBody.innerHTML =
          '<tr><td colspan="7" class="text-center py-4 text-gray-400">Loading transactions...</td></tr>';

        const res = await apiRequest("/admin/transactions", "GET");

        if (res.ok) {
          transactionsTableBody.innerHTML = "";
          if (res.data.transactions.length > 0) {
            res.data.transactions.forEach((tx) => {
              const row = document.createElement("tr");
              row.className = "hover:bg-gray-700";

              row.innerHTML = `
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-200">${
                    tx._id
                  }</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${
                    tx.from_account
                  }</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${
                    tx.to_account
                  }</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-200">${tx.amount.toFixed(
                    2
                  )}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${
                    tx.type
                  }</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${
                    tx.description
                  }</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${new Date(
                    tx.timestamp
                  ).toLocaleString()}</td>
              `;
              transactionsTableBody.appendChild(row);
            });
          } else {
            transactionsTableBody.innerHTML =
              '<tr><td colspan="7" class="text-center py-4 text-gray-400">No transactions found.</td></tr>';
          }
        } else {
          transactionsTableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-500 py-4">Network or server error.</td></tr>`;
        }
      }

      async function downloadPdfReport() {
        // Since reports have been removed, this function is now an empty stub.
        showNotification("Reports functionality has been removed.", "info");
      }
    </script>
  </body>
</html>
